# Project: 中国古诗文接龙
## 项目介绍 Introduction
这个项目的要求如下：假设全部的常见古诗文中句子构成集合 $\mathcal C$，常见的古诗文接龙规则为：如果句子 $A$ 的最后一个字和句子 $B$ 的第一个字读音相同（音调可以不同）或者字一样（可能为多音字），则可以从 $A$ 接龙到 $B$。

例如，床前明月光 可以接龙到 光照大地。同时，我报路长嗟日暮 可以接龙到 暮色苍茫看劲松；自将磨洗认前朝 可以接龙到 朝辞白帝彩云间。

## 功能需求 Objectives
利用 python 程序实现两个功能
1. 解题功能：给出开始的一句古诗文 $S$ 和结尾的古诗文 $T$. 你需要给出一个合法的接龙序列 $[S, A_1, A_2, \ldots, A_k, T]$，使得每一句都在集合 $\mathcal C$ 中，并且满足接龙规则。如果有多种可能的接龙序列，输出长度最短的任意一种即可。如果不存在合法的接龙序列，则输出 No solution。
2. 游戏功能：你的程序生成一句随机的古诗文 $S\in\mathcal C$ 和一句随机的古诗文 $T\in\mathcal C$，并要求用户输入一个合法的接龙序列 $[S, A_1, A_2, \ldots, A_k, T]$。如果用户输入的接龙序列合法且符合要求，则输出 Correct，否则输出 Incorrect。你需要保证 $S\to T$ 有解，同时你需要判断用户输入的接龙序列是否合法且符合要求。

## 实现细节 Implementation Details

本项目基于 Python 实现，主要包含以下模块：

1.  **数据获取与处理 (`src/data_loader.py`)**:
    *   使用 `chinese-poetry` 数据集，包含**全唐诗**、**全宋词**、**论语**、**诗经**。
    *   解析 JSON 数据，提取诗句。
    *   **繁简转换**：使用 `zhconv` 将所有文本统一转换为简体中文，方便输入和匹配。
    *   清洗数据：去除标点符号，过滤过短的句子。

2.  **拼音与匹配逻辑 (`src/utils.py`)**:
    *   使用 `pypinyin` 库获取汉字拼音。
    *   实现了多音字处理（`heteronym=True`）。
    *   接龙规则：后一句的首字与前一句的尾字，满足同字或同音（忽略声调）即可。
    *   **模糊匹配**：实现了 Levenshtein 距离算法，当用户输入与数据库中的句子仅差 1-2 个字时，提供自动提示和纠错功能。

3.  **图结构与算法 (`src/graph.py`)**:
    *   **隐式图构建**：为了节省内存和提高构建速度，不显式存储所有边。而是建立首字特征桶（Bucket），将所有句子按首字特征（拼音或汉字）分类。
    *   **邻居查找**：给定句子 $S$，计算其尾字特征，直接从对应的桶中获取所有可能的下一句。
    *   **最短路径**：使用广度优先搜索（BFS）算法寻找两个句子之间的最短接龙路径。

4.  **游戏逻辑 (`src/game.py`)**:
    *   **题目生成**：随机选择起点，通过局部 BFS 寻找可达的终点，确保题目有解。
    *   **验证**：检查用户输入的序列是否符合接龙规则，且所有句子均存在于数据集中。

5.  **主程序 (`src/main.py`)**:
    *   提供命令行交互界面（CLI）。
    *   包含解题模式和游戏模式。
    *   **智能提示**：在解题模式中，如果输入的句子不在数据库中，会自动搜索并提示最接近的句子。

## 安装与运行 Installation & Usage

1.  **环境配置**:
    ```bash
    conda create -n poetry python=3.10
    conda activate poetry
    pip install pypinyin requests zhconv
    ```

2.  **数据准备**:
    确保 `data/` 目录下包含 `poet.tang.0.json`, `ci.song.0.json`, `lunyu.json`, `shijing.json` 等数据文件。

3.  **运行程序**:
    ```bash
    python -m src.main
    ```
